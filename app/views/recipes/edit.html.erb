<div class="max-w-4xl mx-auto p-6" data-controller="form-fields">
  <h1 class="text-3xl font-bold text-gray-900 mb-8">Edit Recipe</h1>
  
  <%= form_with model: @recipe, local: true, class: "space-y-8", id: "recipe-form" do |form| %>
    <!-- Recipe Details Section -->
    <div class="bg-white rounded-lg shadow-sm border border-gray-200 p-6">
      <h2 class="text-xl font-semibold text-gray-900 mb-4">Recipe Details</h2>
      <div class="space-y-4">
        <div>
          <%= form.label :title, class: "block text-sm font-medium text-gray-700 mb-1" %>
          <%= form.text_field :title, required: true, class: "w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500" %>
        </div>
        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
          <div>
            <%= form.label :servings, class: "block text-sm font-medium text-gray-700 mb-1" %>
            <%= form.text_field :servings, class: "w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500" %>
          </div>
          <div>
            <%= form.label :prep_time_mins, "Prep time (mins)", class: "block text-sm font-medium text-gray-700 mb-1" %>
            <%= form.number_field :prep_time_mins, class: "w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500" %>
          </div>
          <div>
            <%= form.label :cook_time_mins, "Cook time (mins)", class: "block text-sm font-medium text-gray-700 mb-1" %>
            <%= form.number_field :cook_time_mins, class: "w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500" %>
          </div>
          <div>
            <%= form.label :source, class: "block text-sm font-medium text-gray-700 mb-1" %>
            <%= form.text_field :source, class: "w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500" %>
          </div>
        </div>
      </div>
    </div>

    <!-- Ingredients Section -->
    <div class="bg-white rounded-lg shadow-sm border border-gray-200 p-6">
      <div class="flex justify-between items-center mb-4">
        <h2 class="text-xl font-semibold text-gray-900">Ingredients</h2>
        <button type="button" id="add-ingredient" class="text-blue-600 hover:text-blue-800 text-sm font-medium">+ Add Ingredient</button>
      </div>
      <div id="ingredients-container" data-form-fields-target="ingredientsContainer">
        <%= form.fields_for :ingredient_groups do |group_form| %>
          <%= group_form.hidden_field :name %>
          <%= group_form.hidden_field :id if group_form.object.persisted? %>
          <div class="space-y-2" data-ingredient-group>
            <%= group_form.fields_for :ingredients do |ingredient_form| %>
              <div class="flex items-center space-x-2" data-ingredient>
                <%= ingredient_form.hidden_field :id if ingredient_form.object.persisted? %>
                <%= ingredient_form.text_field :text, placeholder: "Enter ingredient", class: "flex-1 px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500" %>
                <button type="button" class="remove-ingredient text-red-600 hover:text-red-800 text-sm">Remove</button>
              </div>
            <% end %>
          </div>
        <% end %>
        <!-- Template for new ingredients (hidden) -->
        <div class="ingredient-template hidden">
          <div class="flex items-center space-x-2" data-ingredient>
            <input type="text" name="recipe[ingredient_groups_attributes][0][ingredients_attributes][INDEX][text]" placeholder="Enter ingredient" class="flex-1 px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
            <button type="button" class="remove-ingredient text-red-600 hover:text-red-800 text-sm">Remove</button>
          </div>
        </div>
      </div>
    </div>

    <!-- Steps Section -->
    <div class="bg-white rounded-lg shadow-sm border border-gray-200 p-6">
      <div class="flex justify-between items-center mb-4">
        <h2 class="text-xl font-semibold text-gray-900">Cooking Steps</h2>
        <button type="button" id="add-step" class="text-blue-600 hover:text-blue-800 text-sm font-medium">+ Add Step</button>
      </div>
      <div id="steps-container" class="space-y-4" data-form-fields-target="stepsContainer">
        <%= form.fields_for :steps do |step_form| %>
          <div class="step-item" data-step>
            <div class="flex items-start space-x-2">
              <span class="step-number bg-blue-100 text-blue-800 text-sm font-medium px-2 py-1 rounded mt-1"><%= step_form.index + 1 %></span>
              <%= step_form.hidden_field :id if step_form.object.persisted? %>
              <%= step_form.text_area :description, placeholder: "Enter cooking step", rows: 3, class: "flex-1 px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500" %>
              <button type="button" class="remove-step text-red-600 hover:text-red-800 text-sm mt-2">Remove</button>
            </div>
          </div>
        <% end %>
        <!-- Template for new steps (hidden) -->
        <div class="step-template hidden">
          <div class="step-item" data-step>
            <div class="flex items-start space-x-2">
              <span class="step-number bg-blue-100 text-blue-800 text-sm font-medium px-2 py-1 rounded mt-1">1</span>
              <textarea name="recipe[steps_attributes][INDEX][description]" placeholder="Enter cooking step" rows="3" class="flex-1 px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500"></textarea>
              <button type="button" class="remove-step text-red-600 hover:text-red-800 text-sm mt-2">Remove</button>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Submit Button -->
    <div class="flex justify-between">
      <%= link_to "← Back to Recipe", recipe_path(@recipe), class: "text-gray-600 hover:text-gray-800" %>
      <%= form.submit "Update Recipe", class: "bg-blue-600 text-white py-3 px-8 rounded-md font-medium hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 transition-colors" %>
    </div>
  <% end %>
</div>
